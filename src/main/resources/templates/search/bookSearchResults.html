<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
  <meta charset="UTF-8">
  <title>Book Search Results</title>
  <!-- style.css 파일 연결 -->
  <link rel="stylesheet" href="/style.css">
</head>

<body data-bs-spy="scroll" data-bs-target="#header" tabindex="0">

<div layout:fragment="content">
  <section id="billboard">
    <h1>Book Search Results</h1>
    <form class="search-form" method="get" action="/books/search">
      <input type="text" name="keyword" id="keyword" placeholder="검색어를 입력하세요" required>
      <input type="hidden" name="orderBy" value="salePrice" id="orderBy">
      <input type="hidden" name="orderDirection" value="desc" id="orderDirection">
      <input type="hidden" name="pageNum" value="1">
      <div>
        <label><input type="radio" name="type" value="title" id="searchByTitle" checked> 제목으로 검색</label>
        <label><input type="radio" name="type" value="author" id="searchByAuthor"> 저자 이름으로 검색</label>
      </div>
      <button type="submit">검색</button>
    </form>

    <div>
      <a href="#" th:href="@{/books/search(type=${type}, keyword=${keyword}, pageNum=1, orderBy='publishDate', orderDirection='desc')}" class="sort-button">신상품</a>
      <a href="#" th:href="@{/books/search(type=${type}, keyword=${keyword}, pageNum=1, orderBy='salePrice', orderDirection='asc')}" class="sort-button">최저가</a>
      <a href="#" th:href="@{/books/search(type=${type}, keyword=${keyword}, pageNum=1, orderBy='salePrice', orderDirection='desc')}" class="sort-button">최고가</a>
      <a href="#" th:href="@{/books/search(type=${type}, keyword=${keyword}, pageNum=1, orderBy='reviewCount', orderDirection='desc')}" class="sort-button">리뷰 수</a>
      <a href="#" th:href="@{/books/search(type=${type}, keyword=${keyword}, pageNum=1, orderBy='reviewRating', orderDirection='desc')}" class="sort-button">평점</a>
    </div>

    <div class="no-results" th:if="${#lists.isEmpty(books)}">
      <p>검색어 "<span th:text="${keyword}"></span>"에 대한 결과가 없습니다.</p>
    </div>

    <div class="book-container" th:each="book : ${books}">
      <div class="book-card">
        <img th:src="${book.imgPath}" alt="Book Image" class="book-image">
        <div class="book-details">
          <h2><a th:href="@{/books/{bookId}(bookId=${book.id})}" th:text="${book.title}"></a></h2>
          <p><strong>출판사:</strong> <span th:text="${book.publisherName}"></span></p>
          <p><strong>출판일:</strong> <span th:text="${book.publishDate}"></span></p>

          <div class="price">
            <span class="sale-price" th:text="${book.salePrice} + '원'"></span>
            <span class="regular-price" th:text="${book.regularPrice} + '원'"></span>
          </div>

          <p><strong>저자:</strong>
            <span th:each="author, iterStat : ${book.authors}" th:text="${author.name}">
              <span th:if="${iterStat.index < book.authors.size() - 1}">, </span>
            </span>
          </p>

          <div class="star-rating">
            <span th:each="i : ${#numbers.sequence(1, 5)}" th:classappend="${i <= book.reviewRating ? 'filled' : ''}">★</span>
            <span th:text="${book.reviewRating}"></span>
            <span> (리뷰 수 : <span th:text="${book.reviewCount}"></span>)</span>
          </div>

          <form method="post" action="/cart">
            <input type="hidden" name="bookId" th:value="${book.id}">
            <input type="number" name="quantity" value="1" min="1" required>
            <button type="submit">장바구니에 추가</button>
          </form>

        </div>
      </div>
    </div>

  </section>
</div>

</body>
</html>
