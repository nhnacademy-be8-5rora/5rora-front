<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <title>BookSaw - Free Book Store HTML CSS Template</title>
    <meta charset="utf-8">
    <title>layout1</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="description" content="">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="icomoon/icomoon.css">
    <link rel="stylesheet" type="text/css" href="css/vendor.css">
    <link rel="stylesheet" type="text/css" href="style.css">

</head>

<body data-bs-spy="scroll" data-bs-target="#header" tabindex="0">

<div id="header-wrap">

    <div class="top-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6">
                    <div class="social-links">
                        <ul>
                            <li>
                                <a href="#"><i class="icon icon-facebook"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="icon icon-twitter"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="icon icon-youtube-play"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="icon icon-behance-square"></i></a>
                            </li>
                        </ul>
                    </div><!--social-links-->
                </div>
                <div class="col-md-6">
                    <div class="right-element">
                        <a href="#" class="user-account for-buy"><i
                                class="icon icon-user"></i><span>Account</span></a>
                        <a href="#" class="cart for-buy"><i class="icon icon-clipboard"></i><span>Cart:(0
									$)</span></a>

                        <div class="action-menu">

                            <div class="search-bar">
                                <!-- 검색 아이콘 -->
                                <a href="#" class="search-button search-toggle" data-selector="#header-wrap">
                                    <i class="icon icon-search"></i>
                                </a>
                                <!-- 검색 폼 -->
                                <form role="search" method="get" class="search-box" action="/books/search">
                                    <input class="search-field text search-input" placeholder="Search" type="search" name="keyword">
                                    <input type="hidden" name="type" value="title">
                                    <input type="hidden" name="pageNum" value="1">
                                </form>
                            </div>

                        </div>

                    </div><!--top-right-->
                </div>

            </div>
        </div>
    </div><!--top-content-->

    <header id="header">
        <div class="container-fluid">
            <div class="row">

                <div class="col-md-2">
                    <div class="main-logo">
                        <a href="index.html"><img src="images/main-logo.png" alt="logo"></a>
                    </div>

                </div>

                <div class="col-md-10">

                    <nav id="navbar">
                        <div class="main-menu stellarnav">
                            <ul class="menu-list">
                                <li class="menu-item active"><a href="#home">Home</a></li>
                                <!-- 카테고리 메뉴 -->
                                <li class="menu-item has-sub" id="categoryMenu">
                                    <a href="#" class="nav-link">Categories</a>
                                    <ul class="category-container" id="categoryList" style="display: none;">
                                        <!-- 상위 카테고리 -->
                                        <li th:each="category : ${categories}"
                                            th:data-id="${category.id}"
                                            class="category-item">
                                            <a th:href="@{/books/search(type='category', keyword=${category.id}, pageNum=1, orderBy='salePrice', orderDirection='desc')}"
                                               class="nav-link" th:text="${category.name}"></a>
                                            <ul class="sub-category-list" style="display: none; position: absolute; left: 100%; top: 0;"></ul>
                                        </li>
                                    </ul>
                                </li>


                                <li class="menu-item has-sub">
                                    <a href="#pages" class="nav-link">Pages</a>
                                    <ul>
                                        <li class="active"><a href="index.html">Home</a></li>
                                        <li><a href="index.html">About</a></li>
                                        <li><a href="index.html">Styles</a></li>
                                        <li><a href="index.html">Blog</a></li>
                                        <li><a href="index.html">Post Single</a></li>
                                        <li><a href="index.html">Our Store</a></li>
                                        <li><a href="index.html">Product Single</a></li>
                                        <li><a href="index.html">Contact</a></li>
                                        <li><a href="index.html">Thank You</a></li>
                                    </ul>
                                </li>
                                <li class="menu-item"><a href="#featured-books" class="nav-link">Featured</a></li>
                                <li class="menu-item"><a href="#popular-books" class="nav-link">Popular</a></li>
                                <li class="menu-item"><a href="#special-offer" class="nav-link">Offer</a></li>
                                <li class="menu-item"><a href="#latest-blog" class="nav-link">Articles</a></li>
                                <li class="menu-item"><a href="#download-app" class="nav-link">Download App</a></li>
                            </ul>

                            <div class="hamburger">
                                <span class="bar"></span>
                                <span class="bar"></span>
                                <span class="bar"></span>
                            </div>
                        </div>
                    </nav>

                </div>

            </div>
        </div>
    </header>

</div><!--header-wrap-->

<!-- content 를 출력한다 -->
<th:block layout:fragment="content"></th:block>

<footer id="footer">
    <div class="container">
        <div class="row">

            <div class="col-md-4">

                <div class="footer-item">
                    <div class="company-brand">
                        <img src="images/main-logo.png" alt="logo" class="footer-logo">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sagittis sed ptibus liberolectus
                            nonet psryroin. Amet sed lorem posuere sit iaculis amet, ac urna. Adipiscing fames
                            semper erat ac in suspendisse iaculis.</p>
                    </div>
                </div>

            </div>

            <div class="col-md-2">

                <div class="footer-menu">
                    <h5>About Us</h5>
                    <ul class="menu-list">
                        <li class="menu-item">
                            <a href="#">vision</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">articles </a>
                        </li>
                        <li class="menu-item">
                            <a href="#">careers</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">service terms</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">donate</a>
                        </li>
                    </ul>
                </div>

            </div>
            <div class="col-md-2">

                <div class="footer-menu">
                    <h5>Discover</h5>
                    <ul class="menu-list">
                        <li class="menu-item">
                            <a href="#">Home</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">Books</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">Authors</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">Subjects</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">Advanced Search</a>
                        </li>
                    </ul>
                </div>

            </div>
            <div class="col-md-2">

                <div class="footer-menu">
                    <h5>My account</h5>
                    <ul class="menu-list">
                        <li class="menu-item">
                            <a href="#">Sign In</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">View Cart</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">My Wishtlist</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">Track My Order</a>
                        </li>
                    </ul>
                </div>

            </div>
            <div class="col-md-2">

                <div class="footer-menu">
                    <h5>Help</h5>
                    <ul class="menu-list">
                        <li class="menu-item">
                            <a href="#">Help center</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">Report a problem</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">Suggesting edits</a>
                        </li>
                        <li class="menu-item">
                            <a href="#">Contact us</a>
                        </li>
                    </ul>
                </div>

            </div>

        </div>
        <!-- / row -->

    </div>
</footer>

<div id="footer-bottom">
    <div class="container">
        <div class="row">
            <div class="col-md-12">

                <div class="copyright">
                    <div class="row">

                        <div class="col-md-6">
                            <p>© 2022 All rights reserved. Free HTML Template by <a
                                    href="https://www.templatesjungle.com/" target="_blank">TemplatesJungle</a></p>
                        </div>

                        <div class="col-md-6">
                            <div class="social-links align-right">
                                <ul>
                                    <li>
                                        <a href="#"><i class="icon icon-facebook"></i></a>
                                    </li>
                                    <li>
                                        <a href="#"><i class="icon icon-twitter"></i></a>
                                    </li>
                                    <li>
                                        <a href="#"><i class="icon icon-youtube-play"></i></a>
                                    </li>
                                    <li>
                                        <a href="#"><i class="icon icon-behance-square"></i></a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                    </div>
                </div><!--grid-->

            </div><!--footer-bottom-content-->
        </div>
    </div>
</div>

<script src="/js/jquery-1.11.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
<script src="/js/plugins.js"></script>
<script src="/js/script.js"></script>

<script>
    let cachedCategories = {}; // 카테고리 데이터를 캐시로 저장

    // 카테고리 데이터 로드 함수
    function loadCategoryData(categoryId) {
        console.log("Category ID: ", categoryId); // categoryId 값 확인

        // categoryId가 null이거나 잘못된 값이 전달되었을 경우
        if (!categoryId) {
            categoryId = 0;
        }

        // 이미 캐시된 데이터가 있다면 API 요청을 생략하고 캐시된 데이터 사용
        if (cachedCategories[categoryId]) {
            updateCategoryList(categoryId, cachedCategories[categoryId]);
            return;
        }

        // fetch 요청을 보내기 전에 categoryId가 유효한지 확인
        fetch(`/categories/${categoryId}`)
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        console.error('Error response:', text);  // 받은 텍스트 출력
                        throw new Error('Network response was not ok');
                    });
                }
                return response.json();  // JSON 응답으로 받기
            })
            .then(data => {
                console.log('Parsed Category Data:', data);
                if (Array.isArray(data)) {
                    cachedCategories[categoryId] = data; // 데이터 캐시
                    updateCategoryList(categoryId, data); // 카테고리 리스트 업데이트
                } else {
                    console.error('Invalid category data:', data);
                }
            })
            .catch(error => {
                console.error('Error fetching category data:', error);
            });
    }

    // 카테고리 리스트 업데이트 함수
    function updateCategoryList(categoryId, categories) {
        console.log("Updating Category List for ID:", categoryId);  // 업데이트 시작 로그 확인

        // 마우스를 올린 상위 카테고리 항목을 찾음
        const categoryItem = document.querySelector(`[data-id="${categoryId}"]`);
        if (!categoryItem) {
            console.error(`Category item with data-id "${categoryId}" not found.`);
            return;
        }

        // 상위 카테고리 항목 내부의 하위 카테고리 리스트를 찾음
        let subCategoryList = categoryItem.querySelector('.sub-category-list');
        if (!subCategoryList) {
            subCategoryList = document.createElement('ul');
            subCategoryList.classList.add('sub-category-list');
            categoryItem.appendChild(subCategoryList);
        }

        // 기존 하위 카테고리 내용 초기화
        subCategoryList.innerHTML = '';

        // 하위 카테고리 추가
        categories.forEach(category => {
            const li = document.createElement('li');
            li.textContent = category.name;
            li.dataset.id = category.id;
            subCategoryList.appendChild(li);
        });

        // 카테고리 항목의 위치를 기반으로 하위 카테고리 위치 설정
        const rect = categoryItem.getBoundingClientRect();
        subCategoryList.style.display = 'block';
        subCategoryList.style.position = 'absolute';
        subCategoryList.style.left = `${rect.width}px`; // 카테고리 항목의 너비만큼 오른쪽에 배치
        subCategoryList.style.top = '0';
        subCategoryList.style.backgroundColor = 'white';
        subCategoryList.style.border = '1px solid #ddd';
        subCategoryList.style.zIndex = '10';
    }

    // 메뉴 항목에 대한 마우스 이벤트 추가
    document.querySelectorAll('.category-item').forEach(item => {
        item.addEventListener("mouseover", function(event) {
            // `this`는 현재 이벤트가 발생한 `category-item` 요소를 가리킴
            const categoryId = this.getAttribute('data-id');  // `this`로 이벤트 발생한 요소 참조
            console.log("Mouseover Category ID: ", categoryId); // categoryId 값 확인

            if (categoryId) {
                loadCategoryData(categoryId); // 해당 categoryId로 하위 카테고리 로드
            } else {
                console.error("data-id is missing or incorrect!");
            }
        });

        item.addEventListener("mouseout", function(event) {
            const subCategoryList = item.querySelector('.sub-category-list');
            if (subCategoryList) {
                subCategoryList.style.display = 'none'; // 마우스가 벗어나면 숨기기
            }
        });
    });
</script>


</body>

</html>